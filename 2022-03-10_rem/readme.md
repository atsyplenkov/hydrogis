### Что такое `REM`
REM — от англ. relative elevation model, т.е. модель относительных высоты. Иными словами, та же самая ЦМР, но в относительных высотах. Это довольно бесполезный для математических расчетов способ визуализации рельефа, который позволяет делать красивые и наглядные иллюстрации пойменных поверхностей и пояса современного руслоформирования. В рамках данной практической мы будем строить `REM` относительно высот водной поверхности (ВП). Тут важно понимать, что на самом деле глобальные ЦМР (SRTM, ALOS, ASTER и т.д.) пока не умеют отражать истинное положение ВП, так как вода на снимках источник большого количества помех из-за высокой отражательной способности. Так что скорее всего под ВП мы будем понимать что-то среднее между поверхностью воды, дна и, местами, льда.

В данной практической под 
  - `dem` имеется ввиду ваша цифровая модель рельефа. У меня на скриншотах и в папке `data` это файл `input_dem.tif`
  - ПКМ — это правая кнопка мыши
  - ВП — водная поверхность

> Данная практическая основана на [туториале](https://dancoecarto.com/creating-rems-in-qgis-the-idw-method) 2022 года от Дэниела Коу. Если возникли какие то трудности, то попробуйте посмотреть, что же Дэниел советует делать в оригинале. Если интересны другие способы построения моделей относительных высот, обратите внимание на этот его [мануал](https://dancoecarto.com/creating-rems-in-qgis-the-cross-section-method).

## Перед началом работы
1. Установить `Value tool` для быстрого определения значений растра. Перейдите в Pugins → Manage and Install Plugins. В поиске введите название плагина.
<p align="center">
<img align="center" src="https://user-images.githubusercontent.com/34775595/157506141-ccf8b557-0ec7-4efe-a458-af6913d08d2b.png" height="20%" width = "42%" >
<img align="center" src="https://user-images.githubusercontent.com/34775595/157506467-2c7b43ba-f7d9-49b0-abe0-923bf3c23e9e.png" height="20%" width = "30%" >
</p>

2. Этот плагин должен активироваться сразу. Если этого не произошло, то включите его вручную. Для этого щелкните ПКМ на пустую область панелей (1), поставьте галочку напротив `Value tool` (2).
<p align="center">
<img src="https://user-images.githubusercontent.com/34775595/157507645-b9a0cf8c-d56f-4c57-bc91-3366883d7ece.png" height="20%" width = "30%" >
</p>

## I. Определение перепада высот ВП и отрисовка ЦМР
1. При помощи `Value tool` определям высоты в начале и конце участка. Запоминаем эти цифры. В случае примера это 115 и 254. Обратите внимание на название растра, с которого снимаются значения. Данные плагин обновляет значение растров при перемещении курсора.
<p align="center">
<img src="https://user-images.githubusercontent.com/34775595/157509600-e12f6320-cd67-4919-8f41-47515ecde470.png" height="50%" width = "50%" >
</p>
2. Изменяем способ отрисовки растра `dem`. Для этого ПКМ на слой `dem`, далее Properties → Symbology → Render type ставим `Singleband pseudocolor`. Меняем настройки `Min` и `Max` в соответсвии с тем диапазоном, что мы определили в прошлом шаге.

![qgis-bin_aQzZL1NGH1](https://user-images.githubusercontent.com/34775595/157511096-c4591907-2365-44fd-9baf-697ee0a89e71.gif)

3. У нас получилась ЦМР раскрашенная по урезанному диапазону высот, которая уже в принципе цветом выделяет границы поймы. 
<p align="center">
<img src="https://user-images.githubusercontent.com/34775595/157511487-675f3ff5-9cf0-42d1-b4df-6294eb096fe5.png" height="50%" width = "50%" >
</p>

4. Далее необходимо создать копию слоя `dem` и сделать из этой копии отмывку рельефа (hillshade). 

## II. Создание модели относительных высот — `rem`
1. В первую очередь необходимо сделать центральную линию. Для этого вы можете использовать центральную линию созданную ранее, или, отрисовать ее вручную. Ручная оцифровка в данном случае лучше, так как нам важно, чтобы эта линия шла точно по руслу.
2. Создаем новый векторный слой: Layer → Create Layer → New Shapefile Layer. Задаем ему имя (у меня это `nal_centerline`), выбираем тип геометрии (`LineString`) и проекцию, такую же, как у слоя `dem`.
<p align="center">
<img src="https://user-images.githubusercontent.com/34775595/157514676-7d8b3db1-86eb-4614-b242-94b15e17c574.png" height="50%" width = "50%" >
</p>
3. Этот новый шейпфайл тут же появится в окне слоев. Выбираем его и начинаем редактировать. ЧТобы закончить редактирование надо нажать ПКМ. Сохраняем результат.

![qgis-bin_ORHRVGuD5n](https://user-images.githubusercontent.com/34775595/157516798-15685133-97c7-43b5-87fd-90d8525a11b7.gif)


5. Теперь над необходимо построить продольный профиль ВП. Для этого создадим точечный файл вдоль нашей центральной линии. Для этого открываем Processing Toolbox (`Ctrl+Alt+T`) и ищем `Points along geometry`. Делаем точки каждые 50 м (это значение можете взять произвольное).

<p align="center">
<img src="https://user-images.githubusercontent.com/34775595/157516771-4f7e3c1d-6e6b-4db1-8916-429acf4dbdf5.png" height="50%" width = "50%" >
</p>

6. Теперь нам в эти точки необходимо записать значение высот с ЦМР. Это можно сделать при помощи `Sample raster values`.

<p align="center">
<img src="https://user-images.githubusercontent.com/34775595/157517179-78be331a-547e-4a5f-92e0-6b09e085fb9f.png" height="50%" width = "50%" >
</p>

7. В каждой точке теперь есть поле `SAMPLE_` в котором прописана высота.

<p align="center">
<img src="https://user-images.githubusercontent.com/34775595/157517314-7a421fc2-1d3e-4533-a5e6-c83fabdca0cb.png" height="50%" width = "50%" >
</p>

